<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Album Foto Batari</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&family=Playfair+Display:wght@400&display=swap" rel="stylesheet">

<style>
html,body{
    margin:0;
    height:100%;
    overflow:hidden;
    background:#000;
    touch-action:none;
}

/* ================= SPLASH ================= */

#startOverlay{
    position:fixed;
    inset:0;
    background:#000;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    text-align:center;
    color:white;
    z-index:100;
    transition:opacity .6s ease, transform .6s ease;
}

#startOverlay.exit{
    opacity:0;
    transform:scale(1.05);
    pointer-events:none;
}

.anim-wrapper{
    position:relative;
    display:flex;
    align-items:center;
    justify-content:center;
    height:120px;
    margin-bottom:40px;
}

.phone-rotate{
    position:absolute;
    width:35px;
    height:65px;
    border:2px solid white;
    border-radius:7px;
    animation:phoneLoop 7s cubic-bezier(.77,0,.18,1) infinite;
}

@keyframes phoneLoop{
    0%   {transform:translateX(0) rotate(0deg);}
    15%  {transform:translateX(0) rotate(90deg);}
    30%  {transform:translateX(-60px) rotate(90deg);}
    70%  {transform:translateX(-60px) rotate(90deg);}
    85%  {transform:translateX(0) rotate(90deg);}
    100% {transform:translateX(0) rotate(0deg);}
}

.divider{
    position:absolute;
    width:2px;
    background:white;
    height:0;
    left:50%;
    transform:translateX(-1px);
    animation:lineLoop 7s cubic-bezier(.77,0,.18,1) infinite;
}

@keyframes lineLoop{
    0%   {height:0;}
    28%  {height:0;}
    38%  {height:60px;}
    68%  {height:60px;}
    78%  {height:0;}
    100% {height:0;}
}

.reveal-text{
    position:absolute;
    left:50%;
    transform:translateX(20px);
    display:flex;
    flex-direction:column;
    align-items:flex-start;
    font-family:'Abril Fatface',serif;
    font-size:16px;
    line-height:1.1;
    overflow:hidden;
}

.reveal-text span{
    transform:translateX(-120%);
    opacity:0;
    animation:textLoop 7s cubic-bezier(.77,0,.18,1) infinite;
}

.reveal-text span:nth-child(1){ animation-delay:.1s; }
.reveal-text span:nth-child(2){ animation-delay:.2s; }
.reveal-text span:nth-child(3){ animation-delay:.3s; }

@keyframes textLoop{
    0%   {transform:translateX(-120%);opacity:0;}
    38%  {transform:translateX(-120%);opacity:0;}
    48%  {transform:translateX(0);opacity:1;}
    68%  {transform:translateX(0);opacity:1;}
    78%  {transform:translateX(-120%);opacity:0;}
    100% {transform:translateX(-120%);opacity:0;}
}

.title{
    font-family:'Abril Fatface',serif;
    font-size:28px;
    margin-bottom:16px;
}

.subtitle{
    font-family:'Playfair Display',serif;
    font-size:13px;
    opacity:.85;
    line-height:1.6;
}

/* ================= FIREFLIES ================= */

#fireflyCanvas{
    position:fixed;
    inset:0;
    z-index:101;
    pointer-events:none;
}

/* ================= EXIT BUTTON ================= */

#exitBtn{
    position:fixed;
    top:20px;
    right:20px;
    font-size:28px;
    color:white;
    cursor:pointer;
    z-index:200;
    display:none;
}

/* ================= ALBUM ================= */

.stage{
    position:fixed;
    inset:0;
    height:100dvh;
    display:flex;
    justify-content:center;
    align-items:center;
    background: radial-gradient(circle at center,#2e2e2e 0%,#111 100%);
    overflow:hidden;
}

.scale-wrapper{ 
    transform-origin:center; 
}

#flipbook{ 
    width:1308px; 
    height:600px; 
    touch-action:none;
    transform-origin:center center;
    will-change:transform;
}

.page{
    position:relative;
    background:white;
    box-shadow:0 15px 40px rgba(0,0,0,.25);
}

.page img{
    width:100%;
    height:100%;
    object-fit:contain;
}
</style>
</head>

<body>

<audio id="ambientAudio" src="sound.mp3" preload="auto" loop></audio>
<canvas id="fireflyCanvas"></canvas>

<div id="startOverlay">
    <div class="anim-wrapper">
        <div class="phone-rotate"></div>
        <div class="divider"></div>
        <div class="reveal-text">
            <span>Rotate</span>
            <span>Your</span>
            <span>Phone</span>
        </div>
    </div>

    <div class="title">Album Foto</div>
    <div class="subtitle">
        Juni 2022 - Juli 2025<br>
        Perjalanan Seorang Anak Manusia<br>
    </div>

    <div class="subtitle">
        Ketuk di mana saja untuk membuka
    </div>
</div>

<div id="exitBtn">âœ•</div>

<div class="stage">
    <div class="scale-wrapper">
        <div id="flipbook"></div>
    </div>
</div>

<script src="page-flip.browser.js"></script>

<script>

/* ================= FULLSCREEN ================= */

function requestFullscreen(){
    const el=document.documentElement;
    if(el.requestFullscreen){ el.requestFullscreen(); }
    else if(el.webkitRequestFullscreen){ el.webkitRequestFullscreen(); }
    else if(el.msRequestFullscreen){ el.msRequestFullscreen(); }
}

/* ================= AUDIO ================= */

const ambientAudio=document.getElementById("ambientAudio");
ambientAudio.volume=0.4;
function unlockAudio(){ ambientAudio.play().catch(()=>{}); }

/* ================= FIREFLIES ================= */

const canvas=document.getElementById("fireflyCanvas");
const ctx=canvas.getContext("2d");
let w,h,speed=1;

function resize(){
    w=canvas.width=window.innerWidth;
    h=canvas.height=window.innerHeight;
}
resize();
window.addEventListener("resize",resize);

class Firefly{
    constructor(){this.reset();}
    reset(){
        this.size=Math.random()*6+6;
        this.x=Math.random()*w;
        this.y=Math.random()*h;
        this.angle=Math.random()*Math.PI*2;
        this.speedFactor=Math.random()*0.5+0.3;
        this.pulse=Math.random()*Math.PI*2;
        this.trail=[];
    }
    update(){
        this.pulse+=0.05;
        this.x+=Math.cos(this.angle)*this.speedFactor*speed;
        this.y+=Math.sin(this.angle)*this.speedFactor*speed;
        this.trail.push({x:this.x,y:this.y});
        if(this.trail.length>12) this.trail.shift();
    }
    draw(){
        for(let i=0;i<this.trail.length;i++){
            const t=this.trail[i];
            ctx.beginPath();
            ctx.arc(t.x,t.y,this.size*(i/this.trail.length),0,Math.PI*2);
            ctx.fillStyle="rgba(255,215,90,"+(i/this.trail.length*0.2)+")";
            ctx.fill();
        }
        const glow=(Math.sin(this.pulse)+1)/2;
        ctx.beginPath();
        ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
        ctx.fillStyle="rgba(255,215,90,"+(0.4+glow*0.6)+")";
        ctx.shadowColor="rgba(255,215,90,"+(0.6+glow*0.4)+")";
        ctx.shadowBlur=20+glow*25;
        ctx.fill();
    }
}

const flies=[];
for(let i=0;i<8;i++) flies.push(new Firefly());

function animate(){
    ctx.clearRect(0,0,w,h);
    flies.forEach(f=>{f.update();f.draw();});
    requestAnimationFrame(animate);
}
animate();

/* ================= SPLASH ================= */

const overlay=document.getElementById("startOverlay");
const exitBtn=document.getElementById("exitBtn");

overlay.addEventListener("click",()=>{
    requestFullscreen();
    unlockAudio();
    speed=4;
    overlay.classList.add("exit");
    setTimeout(()=>{
        overlay.style.display="none";
        canvas.style.display="none";
        exitBtn.style.display="block";
    },600);
});

exitBtn.addEventListener("click",()=>location.reload());

/* ================= LOAD WEBP ================= */

const flipbook=document.getElementById("flipbook");
const wrapper=document.querySelector(".scale-wrapper");

for(let i=1;i<=80;i++){
    const page=document.createElement("div");
    page.classList.add("page");
    const img=document.createElement("img");
    img.src="images/"+i+".webp";
    page.appendChild(img);
    flipbook.appendChild(page);
}

const pageFlip=new St.PageFlip(flipbook,{
    width:654,
    height:600,
    size:"fixed",
    showCover:true,
    usePortrait:false,
    drawShadow:true,
    flippingTime:480
});

pageFlip.loadFromHTML(document.querySelectorAll(".page"));

/* ================= SCALE RESPONSIVE ================= */

function scaleBook(){
    const scaleX=window.innerWidth/1308;
    const scaleY=window.innerHeight/600;
    wrapper.style.transform=`scale(${Math.min(scaleX,scaleY)*0.95})`;
}
window.addEventListener("resize",scaleBook);
scaleBook();

/* ================= PROFESSIONAL ZOOM ENGINE ================= */

let scale=1;
let posX=0,posY=0;
let startDist=0;
let startScale=1;
let isPinching=false;
let isDragging=false;
let startX=0,startY=0;

function getDistance(t){
    return Math.hypot(
        t[0].clientX - t[1].clientX,
        t[0].clientY - t[1].clientY
    );
}

function apply(){
    flipbook.style.transform=`translate(${posX}px,${posY}px) scale(${scale})`;
}

flipbook.addEventListener("touchstart",e=>{
    if(e.touches.length===2){
        isPinching=true;
        startDist=getDistance(e.touches);
        startScale=scale;
        pageFlip.disable();
    }
    if(e.touches.length===1 && scale>1){
        isDragging=true;
        startX=e.touches[0].clientX-posX;
        startY=e.touches[0].clientY-posY;
    }
},{passive:false});

flipbook.addEventListener("touchmove",e=>{
    if(isPinching && e.touches.length===2){
        e.preventDefault();

        const newDist=getDistance(e.touches);
        let newScale=startScale*(newDist/startDist);
        newScale=Math.min(Math.max(1,newScale),3);

        const rect=flipbook.getBoundingClientRect();
        const centerX=(e.touches[0].clientX+e.touches[1].clientX)/2 - rect.left;
        const centerY=(e.touches[0].clientY+e.touches[1].clientY)/2 - rect.top;

        posX -= (centerX)*(newScale-scale)/newScale;
        posY -= (centerY)*(newScale-scale)/newScale;

        scale=newScale;
        apply();
    }

    if(isDragging && e.touches.length===1 && scale>1){
        e.preventDefault();
        posX=e.touches[0].clientX-startX;
        posY=e.touches[0].clientY-startY;
        apply();
    }
},{passive:false});

flipbook.addEventListener("touchend",()=>{
    if(scale<=1){
        scale=1;
        posX=0;
        posY=0;
        flipbook.style.transition="transform .25s ease";
        apply();
        setTimeout(()=>{
            flipbook.style.transition="none";
            pageFlip.enable();
        },250);
    }
    isPinching=false;
    isDragging=false;
});

</script>

</body>
</html>
